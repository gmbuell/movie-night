// Generated by CoffeeScript 1.6.1
(function() {
  var DrawHelper, MoviePoster;

  $(document).ready(function() {
    WebFont.load({
      google: {
        families: ['Tangerine']
      }
    });
    $.ajaxSetup({
      cache: true
    });
    return $.ajax('http://api.themoviedb.org/3/movie/535/images?api_key=f9279dd427385129a3bf58fe314fa019', {
      type: 'GET',
      dataType: 'json',
      error: function(jqXHR, textStatus, errorThrown) {
        return $('#root').append("AJAX Error: " + textStatus);
      },
      success: function(data, textStatus, jqXHR) {
        var back, _i, _len, _ref;
        $('#root').append("Successful AJAX call:");
        _ref = data.backdrops;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          back = _ref[_i];
          new MoviePoster(back.file_path);
        }
        return console.log(data);
      }
    });
  });

  DrawHelper = (function() {

    function DrawHelper() {}

    DrawHelper.drawImage = function(canvas, img) {
      var ctx;
      canvas.width = img.width;
      canvas.height = img.height;
      ctx = canvas.getContext('2d');
      return ctx.drawImage(img, 0, 0);
    };

    DrawHelper.getAverageRGB = function(canvas) {
      var ctx, data, height, length, width;
      height = canvas.height;
      width = canvas.width;
      ctx = canvas.getContext('2d');
      data = ctx.getImageData(0, 0, width, height);
      length = data.data.length;
      while ((i += blockSize * 4) < length) {
        ++count;
        rgb.r += data.data[i];
        rgb.g += data.data[i + 1];
        rgb.b += data.data[i + 2];
      }
      rgb.r = ~~(rgb.r / count);
      rgb.g = ~~(rgb.g / count);
      rgb.b = ~~(rgb.b / count);
      return rgb;
    };

    DrawHelper.drawText = function(canvas, title) {
      var ctx, text, width;
      ctx = canvas.getContext('2d');
      console.log(canvas.toDataURL());
      ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
      ctx.shadowOffsetX = 2;
      ctx.shadowOffsetY = 2;
      ctx.shadowBlur = 3;
      ctx.shadowColor = "rgba(0,0,0,0.8)";
      ctx.font = "48pt Tangerine";
      ctx.textAlign = "left";
      ctx.textBaseline = "top";
      text = "Cuesta Theater Presents";
      width = ctx.measureText(text).width;
      ctx.fillText(text, (canvas.width - width) / 2, 30);
      width = ctx.measureText(title).width;
      return ctx.fillText(title, (canvas.width - width) / 2, 200);
    };

    return DrawHelper;

  })();

  MoviePoster = (function() {

    function MoviePoster(path) {
      var canvas, ctx, img;
      canvas = $(document.createElement('canvas'));
      $('#root').append(canvas);
      ctx = canvas[0].getContext('2d');
      img = $(document.createElement('img'))[0];
      img.onload = function() {
        DrawHelper.drawImage(canvas[0], img);
        return DrawHelper.drawText(canvas[0], "Flashdance");
      };
      img.crossorigin = "anonymous";
      img.src = "http://image.tmdb.org/t/p/w500".concat(path);
    }

    return MoviePoster;

  })();

}).call(this);
